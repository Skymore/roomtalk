# RoomTalk

[English Version](./README.md)

一个基于 WebSocket 和 Redis 的轻量级实时消息系统，支持房间管理、消息持久化、本地主题切换等功能。适合作为 IM、团队协作、聊天室功能的基础模块。

---

## 🚀 技术栈

### 客户端（Client）

- React + TypeScript
- Tailwind CSS
- React Router
- Socket.io Client
- i18next 多语言支持

### 服务端（Server）

- Node.js + Express.js
- Socket.io
- Redis（数据持久化）
- UUID 用户标识

---

## 🌟 功能特点

- ✅ 实时消息收发
- ✅ 加入或创建房间
- ✅ 本地保存房间列表
- ✅ 消息与房间数据持久化（使用 Redis）
- ✅ 暗色/亮色模式切换
- ✅ 响应式设计（适用于手机与桌面）
- ✅ 中英文多语言支持

---

## 🧪 快速开始

### 环境准备

- 安装 Node.js
- 安装并运行本地 Redis（默认地址：`localhost:6379`）

### 安装依赖

```bash
# 安装服务端依赖
cd server
npm install

# 安装客户端依赖
cd ../client
npm install
```

### 启动系统

你可以使用脚本一键启动：

```bash
./start.sh
```

或者分开启动：

```bash
# 启动服务端
cd server
npm start

# 启动客户端
cd ../client
npm run dev
```

---

## 🧭 使用说明

1. 打开浏览器访问 [http://localhost:3011](http://localhost:3011)
2. 页面将自动为用户分配唯一 ID（存储在 localStorage）
3. 创建房间、加入房间、开始聊天

---

## 🔌 API 接口说明

### HTTP 接口

| 路径 | 方法 | 描述 |
|-----------------------------------------------|--------|------------------------------------------------|
| `/api/rooms/:roomId/messages`                 | `GET`  | 获取指定房间的消息                             |
| `/api/clients/:clientId/rooms`                | `GET`  | 获取指定用户创建的房间列表                     |
| `/api/clients/:clientId/rooms`                | `POST` | 为指定用户创建新房间                           |
| `/api/clients/:clientId/rooms/:roomId`          | `GET`  | 获取指定房间的详细信息（仅限房间创建者）         |
| `/api/rooms/:roomId/messages`                 | `POST` | 向指定房间发送消息                             |

### WebSocket 事件

| 事件名            | 方向         | 描述                                          |
|-------------------|--------------|-----------------------------------------------|
| `register`        | 客户端 → 服务端 | 注册用户，并加入以 clientId 命名的分组            |
| `get_rooms`       | 客户端 → 服务端 | 请求获取当前用户创建的房间                      |
| `create_room`     | 客户端 → 服务端 | 创建房间                                      |
| `join_room`       | 客户端 → 服务端 | 加入房间                                      |
| `leave_room`      | 客户端 → 服务端 | 离开房间                                      |
| `send_message`    | 客户端 → 服务端 | 发送消息到指定房间                            |
| `get_room_by_id`  | 客户端 → 服务端 | 根据房间 ID 请求房间详情                        |
| `message_history` | 服务端 → 客户端 | 返回房间消息历史                              |
| `new_room`        | 服务端 → 客户端 | 推送新房间信息（仅发送给房间创建者）             |
| `new_message`     | 服务端 → 客户端 | 向房间广播新消息                              |

---

## ⚙️ 配置

### 服务端 `.env`

| 变量名       | 默认值                  | 说明       |
|--------------|-------------------------|------------|
| `PORT`       | 3012                    | 服务端端口 |
| `CLIENT_URL` | http://localhost:3011    | CORS 配置  |

### 客户端 `.env`

**.env.development:**

| 变量名            | 默认值                  | 说明              |
|-------------------|-------------------------|-------------------|
| `VITE_SOCKET_URL` | http://localhost:3012    | WebSocket 地址    |

**.env.production:**

| 变量名            | 默认值 | 说明                                  |
|-------------------|--------|---------------------------------------|
| `VITE_SOCKET_URL` | `/`    | 同域部署时使用相对路径                 |

---

## 📦 Redis 持久化

系统默认使用 **RDB 快照** 方式持久化。你可以通过修改 `redis.conf` 来启用 **AOF** 或调整保存策略。

---

## 📄 许可证

MIT License

版权所有 (c) 2024 RoomTalk

特此免费授予任何获得本软件及相关文档文件（以下简称“软件”）副本的人，不受限制地处理本软件的权利，包括但不限于使用、复制、修改、合并、出版、分发、再许可及/或销售软件的副本，并允许其受让人如此做，但须符合以下条件：

上述版权声明及本许可声明应包含在本软件的所有副本或主要部分中。

本软件按“原样”提供，不附带任何明示或暗示的保证，包括但不限于对适销性、特定用途适用性及非侵权性的保证。在任何情况下，作者或版权持有人均不对因软件或软件的使用或其他交易产生的任何索赔、损害或其他责任承担责任，无论是在合同、侵权或其他方面。
```

---

以上即为更新后的英文和中文 README 文件，两份文档中 API 接口部分均采用了更明确的路径参数设计，清晰表达了资源之间的层级关系。